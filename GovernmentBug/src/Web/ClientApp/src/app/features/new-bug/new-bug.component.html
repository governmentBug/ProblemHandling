<div class="bug-form-container"> 
  <div class="report-container">
    <p class="report-info">
      באג זה מדווח ע"י {{ userName }} בתאריך {{ formattedDate }}
    </p>
    <!-- <p class="report-infoR">
      יש {{numDocuments}} מסמכים מצורפים ו {{numFilm}} הסרטות מצורפות
    </p> -->
  </div>

  <form (ngSubmit)="onCheckDuplicates()" #bugForm="ngForm" class="bug-form-grid">

    <div class="bug-form">
      <div class="row-full">
        <label for="nameB">:שם/תקציר הבאג</label>
        <input type="text" [(ngModel)]="newBug.title" name="title" required class="input-field" id="nameB"
        (blur)="addPointTitle()"/>
      </div>

      <div class="row-split">
        <div class="left-col">
          <label for="categoryId">:קטגוריה</label>
          <select [(ngModel)]="newBug.categoryId" name="categoryId" class="select-field" required>
            <option value="0" disabled selected>קטגוריה</option>
            <option *ngFor="let category of allCategory" [ngValue]="category.categoryId">
              {{ category.categoryName }}
            </option>
          </select>

          <label for="priorityId">:עדיפות</label>
          <select [(ngModel)]="newBug.priorityId" name="priorityId" class="select-field" required>
            <option value="0" disabled selected>עדיפות</option>
            <option *ngFor="let priority of allPriority" [ngValue]="priority.priorityId">
              {{ priority.priorityName }}
            </option>
          </select>
        </div>

        <div class="right-col">
          <label for="description">:תיאור הבאג</label>
          <textarea [(ngModel)]="newBug.description" name="description" class="textarea-field" required
          (blur)="addPointDescription()"></textarea>
        </div>
      </div>
    </div>

    <!-- הוספת רכיב ה-autocomplete כאן -->
    <!-- <app-bbb></app-bbb> -->

    <!-- שורת כפתורים -->
    <div class="buttons-row">
      <button type="button" class="screen-btn red" (click)="allAttachments()">
        <i class="fas fa-folder-open"></i> {{ showAttachments ? 'הסתר מסמכים' : 'הצג מסמכים' }}
      </button>
      <button type="button" class="screen-btn yellow" (click)="onScreenshot()">
        <i class="fas fa-camera"></i> צילום מסך
      </button>
      <button type="button" class="screen-btn blue" (click)="onRecordVideo()">
        <i class="fas fa-video"></i> הקלטת מסך
      </button>
      <input type="file" #fileInput hidden (change)="onFileSelected($event)" multiple>
      <button type="button" class="screen-btn green" (click)="onUploadClick(fileInput)">
        <i class="fas fa-upload"></i> העלאת קובץ
      </button>
    </div>

    <!-- כפתור שמירה -->
    <button type="submit" class="save-btn" [disabled]="!bugForm.valid">
      <i class="fas fa-save"></i> שמור
    </button>
  </form>
  <app-search-same-bugs *ngIf="showDuplicateCheck" [bugComparisonQuery]="getBugComparisonQuery()"
    (continue)="onContinueAddBug()" (cancel)="onCancel()" (change)="changeShowSaveButton()">
  </app-search-same-bugs>

  <div *ngIf="showAttachments" class="attachments-container">
    <h3><i class="fas fa-paperclip"></i> קבצים מצורפים</h3>
    <ul class="attachments-list">
      <li *ngFor="let file of allAttachment; let i = index" class="attachment-item">
        <a [href]="fileUrls[i]" target="_blank" class="attachment-link">{{ file.name }}</a>

        <ng-container *ngIf="file.type.startsWith('image')">
          <img [src]="fileUrls[i]" alt="{{file.name}}" class="attachment-preview" />
        </ng-container>

        <ng-container *ngIf="file.type.startsWith('video')">
          <video [src]="fileUrls[i]" controls class="attachment-preview"></video>
        </ng-container>

        <div class="attachment-actions">
          <button (click)="renameFile(i)"><i class="fas fa-pencil-alt"></i> שנה שם</button>
          <button (click)="removeFileByIndex(i)"><i class="fas fa-trash"></i> מחק</button>
        </div>
      </li>
    </ul>
  </div>
  <div>
    <h3>ציון איכות: {{ qualityScore }}</h3>
    <div class="progress-bar"
      [ngClass]="{'low': qualityScore < 50, 'medium': qualityScore >= 50 && qualityScore < 80, 'high': qualityScore >= 80}">
      <div class="progress" [style.width.%]="qualityScore"></div>
    </div>
    <p>{{ qualityMessage }}</p>
  </div>


</div>